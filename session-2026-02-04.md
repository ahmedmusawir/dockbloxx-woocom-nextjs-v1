# Session Log - February 4, 2026

**Project:** DockBloxx WooCommerce Next.js v1  
**Focus:** Daily session tracking and project continuity

---

## üéØ Session Start (10:30 PM UTC+8)

### Context Review
Based on `.windsurf.md` and `docs/ghl-attribution/GHL_ATTRIBUTION_SESSION.md`:
- **Project Status:** GHL Attribution Integration completed (Jan 27-30, 2026)
- **Last Major Work:** 
  - Full end-to-end attribution tracking (UTMs, click IDs, landing page)
  - Coupon auto-fill from QR codes
  - WordPress plugin with GHL webhook integration
  - Build fix (revalidate caching)

### Current Session Objective
- Establish daily session logging convention
- Document ongoing work and maintain continuity
- Ready for next development tasks

---

## üìù Work Log

### 10:30 PM - Session Documentation Setup
**Action:** Created `session-2026-02-04.md` following `.windsurf.md` convention

**Files Referenced:**
- `.windsurf.md` - Project context and conventions
- `docs/ghl-attribution/GHL_ATTRIBUTION_SESSION.md` - Previous session history

**Status:** ‚úÖ Session log initialized

---

## üîë Key Information

### Completed Features (as of Jan 30, 2026)
1. **GHL Attribution Integration**
   - Frontend: `src/lib/attribution.ts`, `src/components/checkout/right-pane/ApplyCoupon.tsx`
   - API: `src/app/api/place-order/route.ts`
   - WordPress Plugin: `docs/wp-plugins/cyberize-attribution.php`
   - Attribution Script: `docs/wp-plugins/attribution-script.md`

2. **Coupon Auto-Fill**
   - Captures `?coupon=XXX` from URL
   - Auto-fills checkout coupon field
   - Shows blue notice prompting user to apply

3. **Build Optimization**
   - Fixed `revalidate: 0` ‚Üí `revalidate: 3600` in `src/services/trackingSeoServices.ts`
   - Resolved Next.js static generation errors

### Test URL (Primary - Feb 4, 2026)
```
http://localhost:3000/?utm_source=facebook&utm_medium=paid-social&utm_campaign=dealer-promo-2026&utm_content=qr-code-variant-a&utm_term=dock-accessories&fbclid=fb_test_dealer_123&coupon=QUICK10
```

**What This Tests:**
- ‚úÖ UTM Source: facebook
- ‚úÖ UTM Medium: paid-social
- ‚úÖ UTM Campaign: dealer-promo-2026
- ‚úÖ UTM Content: qr-code-variant-a
- ‚úÖ UTM Term: dock-accessories (stored as utm_keyword)
- ‚úÖ Facebook Click ID: fb_test_dealer_123
- ‚úÖ Coupon: QUICK10
- ‚úÖ Landing Page: / (auto-captured)

**Test Results (Last Used Jan 30):**
- ‚úÖ All attribution data captured in sessionStorage
- ‚úÖ WooCommerce order meta stored with `_coach_ghl_*` prefix
- ‚úÖ WordPress debug panel shows sync status
- ‚úÖ GHL Contact created with full address
- ‚úÖ GHL Opportunity created with all attribution fields

### Test URL Variations

**Google Ads Test:**
```
http://localhost:3000/?utm_source=google&utm_medium=cpc&utm_campaign=spring-sale-2026&utm_content=ad-variant-b&utm_term=boat-dock-accessories&gclid=gc_test_123&coupon=SPRING20
```

**Direct Traffic (No UTMs):**
```
http://localhost:3000/
```

**Partial UTMs Only:**
```
http://localhost:3000/?utm_source=instagram&utm_medium=social
```

**QR Code with Coupon Only:**
```
http://localhost:3000/?coupon=DEALER15
```

---

## üìã Pending Tasks

### Immediate
- [ ] Await user's next request/task

### Staging Deployment (Not Yet Started)
- [ ] Upload updated WordPress plugin to staging
- [ ] Update Coach's attribution script in WordPress ACF
- [ ] Deploy Next.js frontend to Vercel staging
- [ ] Test complete flow with real orders

### Edge Case Testing (Not Yet Started)
- [ ] Direct traffic (no UTMs)
- [ ] Partial UTMs only
- [ ] Multiple orders from same session
- [ ] Verify idempotency

---

## üí° Lessons Learned / Decisions

*(To be updated as work progresses)*

---

## üêõ Issues Encountered

### 8:14 PM - GHL Opportunity Creation Failing
**Issue:** "Create Or Update Opportunity" action failing with error:
```
stageId must be one of the following values: 75e6332e-cfc6-4dd3-811b-8b50f0f73a8
```

**Context:**
- WordPress plugin ‚úÖ sending data successfully (Order #13558 shows "Sent to GHL: yes")
- GHL workflow ‚ùå "Create Or Update Opportunity" failing
- Previous executions (Jan 28-29) were successful
- **No code changes made**

**Root Cause:** GHL pipeline/stage configuration changed. The stageId stored in the workflow is no longer valid.

**Solution Attempts:**

**Attempt 1 (8:40 PM):** Re-selected stage in workflow dropdown
- Result: ‚ùå Still failing with same error
- Workflow shows "0 Errors" but execution still fails

**Attempt 2 (11:03 PM):** Investigating deeper issue
- WordPress plugin payload confirmed NOT sending stageId (correct behavior)
- Issue is in GHL workflow configuration
- **Root Cause:** GHL "Create Or Update Opportunity" action has both:
  - Static dropdown (for fixed stage selection)
  - Custom value field (for dynamic stage via variables)
- If custom value is set (even empty), it **overrides** the dropdown selection

**Correct Solution:**
1. Open "Create Or Update Opportunity" action in GHL workflow
2. Find the Stage field
3. Click the **tag/variable button** next to the stage dropdown
4. **Clear any custom value** that might be set
5. Ensure only the dropdown is used (select the correct stage)
6. Save workflow
7. Test with new order

**Alternative:** If using custom value, set it to: `75e6332e-cfc6-4dd3-811b-8b50f0f73a8`

**Lesson Learned:** GHL stage IDs are UUIDs that change if pipeline stages are modified. GHL workflow actions can have both static and dynamic field values - dynamic values override static selections even if empty.

---

## üìå Next Steps

1. Wait for user's next task or request
2. Update this file after each significant change
3. Document any new lessons learned or decisions
4. Track test results and outcomes

---

*Last Updated: Feb 4, 2026 @ 11:03 PM UTC+8*
